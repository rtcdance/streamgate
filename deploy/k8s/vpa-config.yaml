---
# Vertical Pod Autoscaling Configuration for StreamGate
# This file contains VPA policies for automatic resource optimization

apiVersion: autoscaling.k8s.io/v1
kind: VerticalPodAutoscaler
metadata:
  name: streamgate-vpa
  namespace: streamgate
  labels:
    app: streamgate
    type: autoscaling
spec:
  targetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: streamgate-blue
  updatePolicy:
    updateMode: "Auto"
  resourcePolicy:
    containerPolicies:
      - containerName: streamgate
        minAllowed:
          cpu: 100m
          memory: 128Mi
        maxAllowed:
          cpu: 2000m
          memory: 2Gi
        controlledResources:
          - cpu
          - memory
        controlledValues: RequestsAndLimits

---
apiVersion: autoscaling.k8s.io/v1
kind: VerticalPodAutoscaler
metadata:
  name: streamgate-canary-vpa
  namespace: streamgate
  labels:
    app: streamgate
    version: canary
    type: autoscaling
spec:
  targetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: streamgate-canary
  updatePolicy:
    updateMode: "Off"
  resourcePolicy:
    containerPolicies:
      - containerName: streamgate
        minAllowed:
          cpu: 100m
          memory: 128Mi
        maxAllowed:
          cpu: 2000m
          memory: 2Gi
        controlledResources:
          - cpu
          - memory
        controlledValues: RequestsAndLimits

---
apiVersion: autoscaling.k8s.io/v1
kind: VerticalPodAutoscaler
metadata:
  name: streamgate-green-vpa
  namespace: streamgate
  labels:
    app: streamgate
    version: green
    type: autoscaling
spec:
  targetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: streamgate-green
  updatePolicy:
    updateMode: "Off"
  resourcePolicy:
    containerPolicies:
      - containerName: streamgate
        minAllowed:
          cpu: 100m
          memory: 128Mi
        maxAllowed:
          cpu: 2000m
          memory: 2Gi
        controlledResources:
          - cpu
          - memory
        controlledValues: RequestsAndLimits
